---
title: "Time Series Analysis Sheet 5"
author: "Tom Kniepkamp"
date: "5 May 2022"
output: html_document
---

## Problem 14 (Linear Filter)

### 1. *In what sense is a linear filter linear?*

### 2. 

### 3. What is the advantage of a causal filter over a non- causal filter

- Causal filters have real- time applications while non- causal filters cannot be observed using real data.

- Non- causal filters possibly use data from future time periods which are not observable. 

## Problem 15 (Combining Linear Filters)

```{r}
pacman:: p_load(ZIM, tseries)

B <- function(y, k){
  if (k >= 0){
    z <- rep(NaN, rep = k)
    for (t in (k+1):length(y)){
      z[t] <- y[t - k]
    }
  }
  else {
    z <- c()
    for (t in 1:length(y + k)){
      z <- append(z, y[t - k])
    }
   # z <- append(as.vector(z), rep(NaN, rep = -k))
  }
  return(z)
}

V <- function(y){
  return(0.2 * B(y, k = -1) + 0.6 + 0.2 * B(y, k = 1))
}

W <- function(y){
  return(1- B(y, k = 5))
}


AP <- AirPassengers

plot(AP)

AP_new <- W(AP)
plot(AP_new, type = "l")

```



### a)

*What could be the use of applying each of the two filters to a time series* ($y_t: t \in \Z$)
- The first one is a symmetric filter which can be used to 
- The second filter can be used to filter out seasonal differences of a frequency of five. 



### b) 

- V first, then W. 
- V increases the number of observations in the time series while W reduces them. 


### c)

Use convolution of linear filters


## Problem 17 

The monthly time series seems to follow a linear trend (see figure below) and 
yearly seaonsal patterns. A linear OLS estimate is applied to estimate the linear trend in price increases. 

OLS: 

$y_t = \hat{\beta}_0 + \hat{\beta}_1 t + \varepsilon$

From slide 5/40, we get $p = 1$ and therefore $\Delta^2 m_t = 0$.

```{r}
pacman:: p_load(stats, TSA)
```



```{r}
# load data and create TS for monthly data
df <- read.table(file = "Transport.txt")
df <- ts(data = df, start = 1993,  deltat = 1/12, names = "Transport")

t <- time(df) 

# use a linear regression model to predict the plot

reg_0 <- lm(df ~ t ) # Model a quadratic trend wrt time t

# Plot the time series with the fit line
plot(df, type = "l", main = "Plot of the Time Series")
points(t, predict.lm(reg_0), type = 'l', col = 'red')
```

Now, we create a high- pass difference filter with respect to the fitted values
of the OLS estimators created above. This will eliminate the trend and keep the 
seasonality. 

```{r}
a <- sort(predict.lm(reg_0), decreasing = F)

f <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

f <- append(f, a[13:length(a)])# high pass filter?
f <- ts(data = f, start = 1993,  deltat = 1/12, names = "High- pass filter")

z <- (df[13:length(df)] - f[13:length(f)])
z <- ts(data = z, start = 1994,  deltat = 1/12, names = "Detrended")

plot(z, type = "l")

spectrum(z)

```
Create low- pass filter to filter out seasonal effects. We choose a $\lambda = 1/12$. 

Seasonal differencing $\Delta_l := y_t - y_{t-l},\, l = 12$

```{r}
# Define differencing function





# use for seasonal filter
d <- function(df, l){
  a <- window(x = df, start = time(df)[1]+l/12)
  for (i in 1:length(a)){
    a[i] = a[i] - df[i]
  }
  return(a)
}

new <- d(df,1)
new_2 <-d(df, 3)
plot(df)
plot(new)
spectrum(new)
spectrum(df)

z_new <- d(z,1.1 )
```




